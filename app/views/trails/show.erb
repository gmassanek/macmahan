<script src="/loadgpx.js" type="text/javascript"></script>
<script type="text/javascript">
  //<![CDATA[

  function loadGPXFileIntoGoogleMap(map, filename) {
    $.ajax({url: filename,
      dataType: "xml",
      success: function(data) {
        var parser = new GPXParser(data, map);
        parser.setTrackColour("#ff0000");     // Set the track line colour
        parser.setTrackWidth(5);          // Set the track line width
        parser.setMinTrackPointDelta(0.001);      // Set the minimum distance between track points
        parser.centerAndZoom(data);
        parser.addTrackpointsToMap();         // Add the trackpoints
        parser.addWaypointsToMap();           // Add the waypoints
      }
    });
  }

  function handleLocationError(browserHasGeolocation, infoWindow, pos) {
    infoWindow.setPosition(pos);
    infoWindow.setContent(browserHasGeolocation ?
        'Error: The Geolocation service failed.' :
        'Error: Your browser doesn\'t support geolocation.');
  }

  $(document).ready(function() {
    var mapOptions = {
      zoom: 8,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById("map"), mapOptions);
    loadGPXFileIntoGoogleMap(map, "/test.gpx");
    var infoWindow = new google.maps.InfoWindow({map: map});

    // Try HTML5 geolocation.
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        var pos = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };

        infoWindow.setPosition(pos);
        infoWindow.setContent('Location found.');
        map.setCenter(pos);
      }, function() {
        handleLocationError(true, infoWindow, map.getCenter());
      });
    } else {
      // Browser doesn't support Geolocation
      handleLocationError(false, infoWindow, map.getCenter());
    }
  });


  //]]>
</script>
</head>
<body>
  <div id="map" style="width: 100%; height: 100%;"></div>
</body>
</html>
